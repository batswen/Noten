<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Scales</title>
<style media="screen">
    body {
        box-sizing: border-box;
    }
    select, button, table {
        font-size: 1.5rem;
    }
	table {
		width: 30%;
		margin-left: auto;
		margin-right: auto;
		table-layout: fixed;
	}
	td {
		text-align: center;
		padding: 0.25rem;
	}
    .flex {
        display: flex;
    }
    .flex-1 {
        flex: 100%;
    }
</style>
</head>
<body>
	<div class="flex" style="width:30%;margin-left:auto;margin-right:auto;">
		<select id="note" class="flex-1" onchange="listnotes()" style="width:50%;">
			<option value="c‚ô≠">C‚ô≠</option>
			<option value="c">C</option>
			<option value="c‚ôØ">C‚ôØ</option>
			<option value="d‚ô≠">D‚ô≠</option>
			<option value="d">D</option>
			<option value="d‚ôØ">D‚ôØ</option>
			<option value="e‚ô≠">E‚ô≠</option>
			<option value="e">E</option>
			<option value="e‚ôØ">E‚ôØ</option>
			<option value="f‚ô≠">F‚ô≠</option>
			<option value="f">F</option>
			<option value="f‚ôØ">F‚ôØ</option>
			<option value="g‚ô≠">G‚ô≠</option>
			<option value="g">G</option>
			<option value="g‚ôØ">G‚ôØ</option>
			<option value="a‚ô≠">A‚ô≠</option>
			<option value="a">A</option>
			<option value="a‚ôØ">A‚ôØ</option>
			<option value="h‚ô≠">B</option>
			<option value="h">H</option>
			<option value="h‚ôØ">H‚ôØ</option>
		</select>
		<select id="gesch" class="flex-1" onchange="listnotes()" style="width:49%;">
			<option value="dur">Dur</option>
			<option value="moll">Moll</option>
			<!--<option value="chrom">Chrom</option>-->
		</select>
	</div>
    <div class="flex" style="width:30%;margin-left:auto;margin-right:auto;">
		<button onclick="zufi()" class="flex-1">Zufall</button>
		<button onclick="l√∂sung()" class="flex-1">L√∂sung zeigen</button>
	</div>
	<table id="table">
		<thead>
			<tr>
				<th>I</th>
				<th>II</th>
				<th>III</th>
				<th>IV</th>
				<th>V</th>
				<th>VI</th>
				<th>VII</th>
				<th>(I)</th>
			</tr>
		</thead>
		<tbody>
			<tr>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
			</tr>
			<tr>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
			</tr>
		</tbody>
	</table>
<script>
(()=>{listnotes()})()
function zufi() {
    document.getElementById("table").style.display="none"

    const NOTE = document.getElementById("note")
    document.querySelector("option[value='" + NOTE[Math.floor(Math.random() * NOTE.length)].value + "']").setAttribute("selected", true)
    listnotes()
}
function l√∂sung() {
    document.getElementById("table").style.display=""
}
function listnotes() {
	const gesch = document.getElementById("gesch").value || "dur"
	let start = document.getElementById("note").value || "c"
	const noten = [
		["c",2],//ces=3, c=2, cis=1
		["d",2],
		["e",1],
		["f",2],
		["g",2],
		["a",2],
		["h",1]
	]
	const dur = [2,2,1,2,2,2,1]
	const moll = [2,1,2,2,1,2,2]
	const chrom = [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1]

	let result = []

	let geschlecht = moll, index = 0, diff = 0, indexSave = 0, diffSave = 0, startSave = start
	if (gesch === "dur") {
		geschlecht = dur
	} else if (gesch === "moll") {
		geschlecht = moll
	} else if (gesch === "chrom") {
		geschlecht = chrom
	}

	if (start.substring(1,2) === "‚ôØ") {
		diff = 1
		start = start.substring(0, 1)
	}
	if (start.substring(1,2) === "‚ô≠") {
		diff = -1
		start = start.substring(0, 1)
	}

	for (let i = 0; i < noten.length; i++) {
		if (noten[i][0] === start) {
			index = i
			break
		}
	}

	indexSave = index
	diffSave = diff

	result.push(startSave)

	for (let i = 0; i < geschlecht.length; i++) {
		diff += geschlecht[i] - getNoteLen(index)
		index++
		if (diff > 0) {
			if (diff > 1) {
				result.push(getNoteName(index) + "ùÑ™")
			} else {
				result.push(getNoteName(index) + "‚ôØ")
			}
		} else if (diff < 0) {
			if (diff < -1) {
				result.push(getNoteName(index) + "‚ô≠‚ô≠")
			} else {
                result.push(getNoteName(index) + "‚ô≠")
			}
		} else {
			result.push(getNoteName(index))
		}
	}

	index = indexSave
	diff = diffSave

	result.push(startSave)

	for (let i = 0; i < geschlecht.length; i++) {
		diff += geschlecht[i] - getNoteLen(index)
		index++

		let resultTemp = ""
		if (diff > 0) {
			resultTemp += getNoteName(index)
			if (diff > 1) {
				resultTemp += "ùÑ™"
			} else {
				resultTemp += "‚ôØ"
			}
			if (diff === 1 && getNoteLen(index) === 1 || diff > 1 && getNoteLen(index) === 2) {
				resultTemp = getNoteName(index + 1)
			}
		} else if (diff < 0) {
			resultTemp += getNoteName(index) + "‚ô≠"
			if (diff < -1) {
				resultTemp += "‚ô≠"
			}
			if (diff === -1 && getNoteLen(index - 1) === 1 || diff < -1 && getNoteLen(index - 1) === 2) {
				resultTemp = getNoteName(index - 1)
			}
		} else {
			resultTemp += getNoteName(index)
		}

		result.push(resultTemp)
	}

    result = result.map(e => e === "h‚ô≠" ? "b" : e)

	let i = 0
	Array.from(document.getElementsByTagName("TD")).forEach(tag => {
		tag.textContent = result[i++]
	})
	function getNoteName(index) {
		return noten[index % 7][0]
	}
	function getNoteLen(index) {
		return noten[index % 7][1]
	}
}
</script>
</body>
</html>
